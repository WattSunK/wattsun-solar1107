<!DOCTYPE html>

<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Checkout - WattSun Solar</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<link href="main.css" rel="stylesheet"/>
<style>.container {
  max-width: 950px;
  width: 98vw;
  margin: 44px auto 0 auto;
  padding: 38px 24px 30px 24px;
  background: #fff;
  border-radius: 13px;
  box-shadow: 0 4px 20px rgba(247,183,51,0.10), 0 1.5px 9px rgba(0,0,0,0.04);
  box-sizing: border-box;
}
h2 {
  text-align: center;
  margin-bottom: 26px;
  font-size: 2em;
  font-weight: bold;
  color: #b47d08;
}
/* --- CART TABLE STYLE --- */
.table-wrapper {
  width: 100%;
  max-width: 100%;
  overflow-x: auto;
  box-sizing: border-box;
  background: #fff;
  border-radius: 10px;
}
.checkout-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  background: #fff;
  margin-bottom: 22px;
  border-radius: 10px;
  box-shadow: 0 1px 8px rgba(0,0,0,0.07);
  overflow: hidden;
  table-layout: auto;
  font-size: 0.97em;
  box-sizing: border-box;
}
.checkout-table th, .checkout-table td {
  text-align: left;
  padding: 14px 12px;
  border-bottom: 1px solid #f2e2b6;
  font-size: 1em;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}
.checkout-table th {
  background-color: #f9eabb;
  color: #444;
  font-weight: bold;
  text-align: center;
  vertical-align: middle;
}
.checkout-table td.product-col {
  text-align: left;
  font-weight: 500;
  min-width: 120px;
  max-width: 180px;
  width: 24%;
  word-break: break-word;
  white-space: normal;
}
.checkout-table td.desc-col {
  min-width: 110px;
  max-width: 230px;
  width: 28%;
  white-space: normal;
}
.checkout-table th.compact-col, .checkout-table td.compact-col {
  width: 70px;
  min-width: 45px;
  max-width: 90px;
  text-align: right;
  white-space: nowrap;
  font-variant-numeric: tabular-nums;
  padding-left: 0;
  padding-right: 0;
  vertical-align: middle;
}
.checkout-table th.compact-col {
  line-height: 1.15;
}
.checkout-table th.compact-col br {
  display: block;
  margin: 0;
  padding: 0;
  content: "";
}
@media (max-width: 900px) {
  .checkout-table th, .checkout-table td { font-size: 0.98em; }
}
@media (max-width: 700px) {
  .checkout-table th, .checkout-table td { padding: 8px 4px; font-size: 0.96em; }
  .checkout-table td.product-col { min-width: 80px; max-width: 120px; }
  .checkout-table td.desc-col { min-width: 50px; max-width: 120px; }
}
/* --- FORM STYLE (unchanged) --- */
.checkout-form {
  margin-top: 20px;
}
.checkout-form label {
  display: block;
  margin-bottom: 7px;
  font-weight: bold;
  font-size: 1.04em;
  margin-top: 12px;
}
.checkout-form input,
.checkout-form textarea {
  width: 100%;
  padding: 14px 12px;
  margin-bottom: 16px;
  border: 1.2px solid #ccc;
  border-radius: 12px;
  font-size: 1em;
  background: #faf9f7;
  transition: border-color 0.2s;
  box-sizing: border-box;
  max-width: 100%;
  resize: vertical;
  display: block;
}
.checkout-form input:focus,
.checkout-form textarea:focus {
  border-color: #f7b733;
  outline: none;
}
@media (max-width: 700px) {
  .checkout-form input,
  .checkout-form textarea {
    padding: 18px 14px;
    margin-bottom: 20px;
  }
}
.checkout-actions {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 16px;
  margin-top: 12px;
  margin-bottom: 6px;
  width: 100%;
}
.checkout-actions .btn,
.checkout-actions .loan-btn {
  min-width: 120px;
  max-width: 170px;
  width: auto !important;
  font-size: 1em;
  padding: 9px 18px;
  margin: 0;
  display: inline-block;
  box-sizing: border-box;
}
.btn, .loan-btn {
  border: none;
  border-radius: 8px;
  color: #fff;
  background: linear-gradient(90deg, #f7b733 0%, #fcf6ba 100%);
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 4px 16px rgba(247,183,51, 0.14);
  letter-spacing: 0.5px;
  text-decoration: none;
  transition: background 0.3s, transform 0.2s, box-shadow 0.2s;
}
.btn:hover, .loan-btn:hover {
  background: linear-gradient(90deg, #fcf6ba 0%, #f7b733 100%);
  color: #b37900 !important;
  transform: translateY(-2px) scale(1.03);
  box-shadow: 0 6px 20px rgba(247,183,51, 0.20);
}
.loan-btn.secondary {
  background: #eee;
  color: #555 !important;
  border: 1px solid #d5c99c;
  box-shadow: none;
}
.loan-btn.secondary:hover {
  background: #ffe180;
  color: #7a6000 !important;
}
@media (max-width:1000px) { .container { max-width: 98vw; padding: 16px 2vw; } }
.nav-toggle {
  display: none;
  font-size: 2rem;
  background: none;
  border: none;
  cursor: pointer;
  margin-left: auto;
}
@media (max-width: 800px) {
  .nav-toggle {
    display: inline-block;
    z-index: 1001;
    position: absolute;
    top: 18px;
    right: 20px;
  }
  nav {
    display: none;
    flex-direction: column;
    background: #fff;
    position: absolute;
    right: 0;
    top: 60px;
    width: 80vw;
    border-radius: 0 0 0 20px;
    box-shadow: 0 10px 32px #ccc;
    padding: 30px 0 30px 0;
    z-index: 1000;
  }
  nav.active {
    display: flex !important;
  }
  nav a {
    margin: 12px 0;
    font-size: 1.3em;
    padding-left: 28px;
    color: #333;
    border-bottom: 1px solid #eee;
    width: 100%;
    display: block;
    text-align: left;
  }
  nav span {
    display: block;
    padding-left: 28px;
    margin: 12px 0 0 0;
  }
}
@media (max-width: 700px) {
  .header-bar h1 { font-size: 1.4em; }
  .checkout-table td.product-col { min-width: 54vw !important; max-width: 100vw !important; }
  .container, .table-wrapper, table { width: 100vw !important; max-width: 100vw !important; }
  .checkout-actions { flex-direction: column !important; align-items: center !important; gap: 12px !important; }
  .checkout-actions .btn, .checkout-actions .loan-btn { width: 80vw !important; max-width: 96vw !important; min-width: 0 !important; font-size: 1em; }
}
.total {
  text-align: right;
  margin-top: 10px;
  font-size: 1.08em;
  font-weight: bold;
  color: #1ab13d;
  letter-spacing: 0.3px;
  padding-right: 18px;
  background: #f9eabb;
  border-radius: 0 0 14px 14px;
  box-shadow: 0 1px 8px rgba(0,0,0,0.07);
  max-width: 100%;
  overflow-x: auto;
}
/* Cart Icon in NavBar */
.cart-icon-link {
  position: relative;
  display: inline-block;
  text-decoration: none;
  color: inherit;
  vertical-align: middle;
  margin-left: 10px;
}
.cart-icon {
  font-size: 1.24em;
  display: flex;
  align-items: center;
  position: relative;
}
.cart-count-badge {
  position: absolute;
  top: -0.7em;
  right: -0.7em;
  background: #19c37d;
  color: #fff;
  font-size: 0.8em;
  min-width: 1.15em;
  height: 1.15em;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  box-shadow: 0 0 0.13em #0001;
  transition: background 0.2s;
  pointer-events: none;
  z-index: 1;
  display: none;
}

@media (max-width: 700px) {
  .checkout-table th.desc-col, 
  .checkout-table td.desc-col {
    display: none;
  }
}

@media (max-width: 700px) {
  .checkout-table th, .checkout-table td {
    font-size: 0.92em;
    padding: 6px 6px;
  }
  .checkout-table td.product-col {
    min-width: 40vw !important;
    max-width: 42vw !important;
  }
  .checkout-table th.compact-col, 
  .checkout-table td.compact-col {
    min-width: 12vw !important;
    max-width: 15vw !important;
    text-align: center;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
  .table-wrapper {
    overflow-x: auto;
  }
}

/* === Mobile Sticky Footer === */
.mobile-nav {
  display: none;
}
@media (max-width: 768px) {
  .mobile-nav {
    display: flex;
    position: fixed;
    bottom: 0;
    height: 56px;
    width: 100%;
    background-color: #f4a940;
    justify-content: space-around;
    align-items: center;
    z-index: 1000;
    box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);
    padding: 0;
  }

  .mobile-nav a {
    font-size: 20px;
    height: 56px;
    line-height: 56px;
    padding: 0;
    margin: 0;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    color: black;
    position: relative;
  }

  #cart-count {
    position: absolute;
    top: 6px;
    right: 10px;
    background: red;
    color: white;
    font-size: 11px;
    min-width: 16px;
    height: 16px;
    border-radius: 8px;
    padding: 0 5px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
  }
}
.logo-container {
  display: flex;
  align-items: center;
  gap: 12px;
  white-space: nowrap;
  padding: 6px 12px;
  margin-left: 10px;
}
.brand-name {
  font-size: 1.8em;
  font-weight: bold;
  color: white;
  white-space: nowrap;
}
.site-logo {
  height: 48px;
  max-width: 48px;
  object-fit: contain;
  vertical-align: middle;
}
@media (max-width: 768px) {
  .logo-container {
    padding: 4px 12px;
    height: 56px;
  }
  .site-logo {
    height: auto;
    max-height: 36px;
    object-fit: contain;
  }
  .brand-name {
    font-size: 1.3em;
  }
}
    /* === Desktop & Mobile Logo Styles from index.html === */
    .logo-container { display: none; }
    .desktop-logo { display: block; }
    .brand-name { font-size: 1.8em; font-weight: bold; color: white; white-space: nowrap; }
    .site-logo { height: 48px; max-width: 48px; object-fit: contain; vertical-align: middle; }
    @media (max-width: 768px) {
      .desktop-logo { display: none; }
      .logo-container { display: flex; align-items: center; gap: 12px; white-space: nowrap; padding: 4px 12px; height: 56px; margin-left: 10px; }
      .site-logo { height: auto; max-height: 36px; object-fit: contain; }
      .brand-name { font-size: 1.3em; }
    }
    @media (max-width: 768px) {
      h1 img.site-logo { width: auto !important; max-height: 32px !important; margin-right: 8px; }
    }
</style>
</head>
<body>
<header>
<div class="header-bar">
      <h1 class="desktop-logo">
        <img src="assets/logo/Wattsun Solar log2.png" alt="WattSun Solar Logo" style="width: 60px; object-fit: contain; margin-right: 10px;">
        WattSun Solar
      </h1>
      <div class="logo-container">
        <img src="assets/logo/Wattsun Solar log2.png" alt="WattSun Solar Logo" class="site-logo"/>
        <span class="brand-name">WattSun Solar</span>
      </div>


<div class="logo-container">
<img alt="WattSun Solar Logo" class="site-logo" src="assets/logo/Wattsun Solar log2.png"/>
<span class="brand-name">WattSun Solar</span>
</div>

<button aria-label="Open menu" class="nav-toggle" onclick="toggleNav()">‚ò∞</button>
</div>
<nav id="mainNav">
<a href="index.html">Home</a>
<a href="solutions.html">Solutions</a>
<a href="shop.html">Shop</a>
<a href="financing.html">Financing</a>
<a href="projects.html">Projects</a>
<a href="contact.html">Contact</a>
<!-- Cart Icon START -->
<a aria-label="View shopping cart" class="cart-icon-link" href="cart.html" title="View cart">
<span class="cart-icon">
    üõí
    <span class="cart-count-badge" id="cart-count-badge">0</span>
</span>
</a>
<!-- Cart Icon END -->
</nav>
</header>
<div class="container">
<h2>Checkout</h2>
<div class="table-wrapper">
<table class="checkout-table" id="cartTable">
<thead>
<tr>
<th class="product-col">Product</th>
<th class="desc-col">Description</th>
<th class="compact-col">Price<br/>(KES)</th>
<th class="compact-col">Deposit<br/>(KES)</th>
<th class="compact-col">Qty</th>
<th class="compact-col">Total<br/>(KES)</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<div class="total" id="totalAmount">Total Deposit: KES 0</div>
<form action="/thankyou.html" autocomplete="on" class="checkout-form" data-netlify="true" id="checkoutForm" method="POST" name="order">
<input name="form-name" type="hidden" value="order"/>
<input id="cart_summary" name="cart_summary" type="hidden"/>
<label for="fullName">Full Name</label>
<input id="fullName" name="fullName" placeholder="Your full name" required="" type="text"/>
<label for="email">Email Address</label>
<input id="email" name="email" placeholder="you@example.com" required="" type="email"/>
<label for="phone">Phone Number</label>
<input id="phone" name="phone" placeholder="+254 7XX XXX XXX" required="" type="tel"/>
<label for="address">Delivery Address</label>
<textarea id="address" name="address" placeholder="Enter delivery location" required="" rows="3"></textarea>
<div class="checkout-actions">
<a class="loan-btn secondary" href="shop.html">‚Üê Back to Shop</a>
<button class="btn" type="submit">Place Order ‚Üí</button>
</div>
</form>
</div>
<footer>
  ¬© 2025 WattSun Solar Kenya | <div class="footer-contacts"><a href="mailto:info@wattsun.co.ke">info@wattsun.co.ke</a></div>
</footer>
<script>
function toggleNav() {
  var nav = document.getElementById("mainNav");
  nav.classList.toggle("active");
}
window.addEventListener('resize', function() {
    if(window.innerWidth > 800) {
        document.getElementById("mainNav").classList.remove("active");
    }
});

document.addEventListener("DOMContentLoaded", function () {
  // If we've just come from calculator.html, stash the selected kit
  const selectedKit = JSON.parse(localStorage.getItem("wattSunSelectedKit"));
  if (selectedKit) {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    if (!cart.some(item => item.name === selectedKit.kit)) {
      cart.push({
        name: selectedKit.kit,
        price: selectedKit.price,
        deposit: Math.round(selectedKit.price * 0.5),
        quantity: 1,
        description: selectedKit.description || ""
      });
      localStorage.setItem("cart", JSON.stringify(cart));
    }
    localStorage.removeItem("wattSunSelectedKit");
  }

  function formatNumber(num) {
    return Number(num).toLocaleString('en-US');
  }

  // Helper to truncate description for table column
  function truncateDesc(desc) {
    return desc && desc.length > 60 ? desc.substring(0, 57) + '...' : desc;
  }

  function renderCart() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const tbody = document.querySelector("#cartTable tbody");
    const summary = document.getElementById("cart_summary");
    tbody.innerHTML = "";
    let totalDeposit = 0;
    let cartSummaryArr = [];

    cart.forEach(item => {
      const qty = item.quantity || 1;
      const desc = item.description || "";
      const deposit = item.deposit;
      const totalPrice = item.price * qty;
      const totalItemDeposit = deposit * qty;
      totalDeposit += totalItemDeposit;

      cartSummaryArr.push(
        `${item.name} (x${qty}): Price ${item.price}, Deposit ${deposit}`
      );

      const row = document.createElement('tr');
      row.innerHTML = `
        <td class="product-col">${item.name}</td>
        <td class="desc-col">${truncateDesc(desc)}</td>
        <td class="compact-col">${formatNumber(item.price)}</td>
        <td class="compact-col">${formatNumber(deposit)}</td>
        <td class="compact-col">${qty}</td>
        <td class="compact-col">${formatNumber(totalPrice)}</td>
        
      `;
      tbody.appendChild(row);
    });

    document.getElementById("totalAmount").textContent =
      "Total Deposit: KES " + totalDeposit.toLocaleString();
    summary.value = cartSummaryArr.join("\n");
  }

  renderCart();

  document.getElementById("checkoutForm").addEventListener("submit", function(e) {
      let valid = true;
      this.querySelectorAll('input[required], textarea[required]').forEach(input => {
          if (!input.value.trim() || input.value.trim() === "0") {
              input.style.borderColor = "red";
              valid = false;
          } else {
              input.style.borderColor = "";
          }
      });
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      if (cart.length === 0) {
          alert("Your cart is empty.");
          valid = false;
      }
      if (!valid) {
          e.preventDefault();
          return false;
      }
      sessionStorage.setItem("clearCartOnThankYou", "true");
  });
});

// --- CART BADGE LOGIC ---
function updateCartCountBadge() {
  let count = 0;
  try {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    count = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
  } catch(e){}
  const badge = document.getElementById('cart-count-badge');
  if (!badge) return;
  if (count > 0) {
    badge.textContent = count;
    badge.style.display = 'flex';
  } else {
    badge.style.display = 'none';
  }
}
document.addEventListener('DOMContentLoaded', updateCartCountBadge);
window.addEventListener('storage', updateCartCountBadge);

if (window.location.pathname.endsWith("thankyou.html") && sessionStorage.getItem("clearCartOnThankYou")) {
    localStorage.removeItem("cart");
    sessionStorage.removeItem("clearCartOnThankYou");
}
</script>
<footer class="mobile-nav">
<a aria-label="Home" href="index.html">üè†</a>
<a aria-label="Account" href="account.html">üë§</a>
<a aria-label="Cart" href="cart.html">üõí<span id="cart-count">2</span></a>
<a aria-label="Menu" href="javascript:void(0);" onclick="document.querySelector('.nav-toggle').click();">‚ò∞</a>
</footer>
</body>
</html>
