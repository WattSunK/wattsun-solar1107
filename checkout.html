<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Checkout - WattSun Solar</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<link href="main.css" rel="stylesheet"/>
<style>
.container {
  max-width: 900px;
  width: 98vw;
  margin: 44px auto 0 auto;
  padding: 38px 24px 30px 24px;
  background: #fff;
  border-radius: 13px;
  box-shadow: 0 4px 20px rgba(247,183,51,0.10), 0 1.5px 9px rgba(0,0,0,0.04);
  box-sizing: border-box;
}
h2 {
  text-align: center;
  margin-bottom: 26px;
  font-size: 2em;
  font-weight: bold;
  color: #b47d08;
}
.table-wrapper {
  width: 100%;
  background: #fff;
  margin-bottom: 18px;
  border-radius: 12px;
}
.container table {
  width: 100%;
  table-layout: fixed;
  border-collapse: separate;
  border-spacing: 0;
  background: #fff;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 1px 8px rgba(0,0,0,0.07);
  font-size: 1em;
  margin: 0;
  min-width: 0;
}
.container th, .container td {
  padding: 10px 5px;
  font-size: 1em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  min-width: 36px;
  vertical-align: middle;
  text-align: center;
  box-sizing: border-box;
}
th {
  background-color: #f9eabb;
  color: #444;
  font-weight: bold;
  font-size: 1.05em;
}
th.product-col, td.product-col { max-width: 130px; min-width: 90px; }
th.checkout-desc-tooltip, td.checkout-desc-tooltip { max-width: 110px; min-width: 80px; }
th.col-unit, td.col-unit { max-width: 90px; min-width: 70px; }
th.col-qty, td.col-qty { min-width: 38px; max-width: 45px; width: 40px; }
th.col-total, td.col-total { min-width: 95px; max-width: 120px; }
th.col-total-deposit, td.col-total-deposit { min-width: 95px; max-width: 120px; }
td.product-col {
  text-align: left;
  font-weight: 500;
  min-width: 90px;
  max-width: 130px;
  word-break: break-word;
  white-space: normal;
}
td.checkout-desc-tooltip {
  position: relative;
  max-width: 110px;
  min-width: 80px;
  cursor: pointer;
  background: none;
}
@media (min-width: 700px) {
  td.checkout-desc-tooltip:hover::after {
    content: attr(data-desc);
    position: absolute;
    left: 0;
    top: 100%;
    z-index: 99;
    min-width: 180px;
    max-width: 320px;
    background: #fffbe8;
    color: #222;
    border: 1px solid #eccd7e;
    border-radius: 9px;
    box-shadow: 0 4px 18px #b47d0844;
    font-size: 0.99em;
    padding: 13px 16px;
    white-space: normal;
    word-break: break-word;
    margin-top: 4px;
    pointer-events: none;
  }
  td.checkout-desc-tooltip:hover {
    background: #fcf6ba;
    z-index: 20;
  }
}
.total {
  text-align: right;
  margin-top: 10px;
  font-size: 1.08em;
  font-weight: bold;
  color: #1ab13d;
  letter-spacing: 0.3px;
  padding-right: 18px;
  background: #f9eabb;
  border-radius: 0 0 14px 14px;
  box-shadow: 0 1px 8px rgba(0,0,0,0.07);
  max-width: 100%;
  overflow-x: auto;
}
.checkout-form {
  margin-top: 20px;
}
.checkout-form label {
  display: block;
  margin-bottom: 7px;
  font-weight: bold;
  font-size: 1.04em;
  margin-top: 12px;
}
.checkout-form input,
.checkout-form textarea {
  width: 100%;
  padding: 14px 12px;
  margin-bottom: 16px;
  border: 1.2px solid #ccc;
  border-radius: 12px;
  font-size: 1em;
  background: #faf9f7;
  transition: border-color 0.2s;
  box-sizing: border-box;
  max-width: 100%;
  resize: vertical;
  display: block;
}
.checkout-form input:focus,
.checkout-form textarea:focus {
  border-color: #f7b733;
  outline: none;
}
@media (max-width: 700px) {
  .checkout-form input,
  .checkout-form textarea {
    padding: 18px 14px;
    margin-bottom: 20px;
  }
}
.checkout-actions {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 16px;
  margin-top: 12px;
  margin-bottom: 6px;
  width: 100%;
}
.checkout-actions .btn,
.checkout-actions .loan-btn {
  min-width: 120px;
  max-width: 170px;
  width: auto !important;
  font-size: 1em;
  padding: 9px 18px;
  margin: 0;
  display: inline-block;
  box-sizing: border-box;
}
.btn, .loan-btn {
  border: none;
  border-radius: 8px;
  color: #fff;
  background: linear-gradient(90deg, #f7b733 0%, #fcf6ba 100%);
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 4px 16px rgba(247,183,51, 0.14);
  letter-spacing: 0.5px;
  text-decoration: none;
  transition: background 0.3s, transform 0.2s, box-shadow 0.2s;
}
.btn:hover, .loan-btn:hover {
  background: linear-gradient(90deg, #fcf6ba 0%, #f7b733 100%);
  color: #b37900 !important;
  transform: translateY(-2px) scale(1.03);
  box-shadow: 0 6px 20px rgba(247,183,51, 0.20);
}
.loan-btn.secondary {
  background: #eee;
  color: #555 !important;
  border: 1px solid #d5c99c;
  box-shadow: none;
}
.loan-btn.secondary:hover {
  background: #ffe180;
  color: #7a6000 !important;
}
@media (max-width:1000px) { .container { max-width: 98vw; padding: 16px 2vw; } }
.nav-toggle {
  display: none;
  font-size: 2rem;
  background: none;
  border: none;
  cursor: pointer;
  margin-left: auto;
}
@media (max-width: 800px) {
  .nav-toggle {
    display: inline-block;
    z-index: 1001;
    position: absolute;
    top: 18px;
    right: 20px;
  }
  nav {
    display: none;
    flex-direction: column;
    background: #fff;
    position: absolute;
    right: 0;
    top: 60px;
    width: 80vw;
    border-radius: 0 0 0 20px;
    box-shadow: 0 10px 32px #ccc;
    padding: 30px 0 30px 0;
    z-index: 1000;
  }
  nav.active {
    display: flex !important;
  }
  nav a {
    margin: 12px 0;
    font-size: 1.3em;
    padding-left: 28px;
    color: #333;
    border-bottom: 1px solid #eee;
    width: 100%;
    display: block;
    text-align: left;
  }
  nav span {
    display: block;
    padding-left: 28px;
    margin: 12px 0 0 0;
  }
}
@media (max-width: 700px) {
  .header-bar h1 { font-size: 1.4em; }
  th.checkout-desc-tooltip, td.checkout-desc-tooltip { display: none !important; }
  th.col-desc, td.col-desc, th.col-unit, td.col-unit, th.col-total-deposit, td.col-total-deposit { display: none !important; }
  td.product-col { width: 54vw !important; min-width: 60px !important; max-width: 100vw !important; }
  .container, .table-wrapper, table { width: 100vw !important; max-width: 100vw !important; }
  .checkout-actions { flex-direction: column !important; align-items: center !important; gap: 12px !important; }
  .checkout-actions .btn, .checkout-actions .loan-btn { width: 80vw !important; max-width: 96vw !important; min-width: 0 !important; font-size: 1em; }
  .total { font-size: 1em; padding-right: 8vw; padding-left: 1vw; }
  .table-wrapper, .container table { border-radius: 10px; }
}
</style>
</head>
<body>
<header>
<div class="header-bar">
<h1>WattSun Solar</h1>
<button aria-label="Open menu" class="nav-toggle" onclick="toggleNav()">‚ò∞</button>
</div>
<nav id="mainNav">
<a href="index.html">Home</a>
<a href="solutions.html">Solutions</a>
<a href="shop.html">Shop</a>
<a href="financing.html">Financing</a>
<a href="projects.html">Projects</a>
<a href="contact.html">Contact</a>
<span id="cartLinkWrapper" style="display:none;">
<a href="cart.html">
    üõí Cart <span id="cartCount" style="font-weight:bold; background:#3E9F50; color:white; padding:2px 6px; border-radius:50%; font-size:0.8em; vertical-align:top;">0</span>
</a>
</span>
</nav>
</header>
<div class="container">
<h2>Checkout</h2>
<div class="table-wrapper">
<table id="cartTable">
<thead>
<tr>
<th class="product-col">Product</th>
<th class="checkout-desc-tooltip">Description</th>
<th class="col-unit">Unit Price (KES)</th>
<th>Deposit/Unit (KES)</th>
<th class="col-qty">Qty</th>
<th class="col-total">Total Price (KES)</th>
<th class="col-total-deposit">Total Deposit (KES)</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<div class="total" id="totalAmount">Total Deposit: KES 0</div>
<form action="/thankyou.html" class="checkout-form" data-netlify="true" id="checkoutForm" method="POST" name="order" autocomplete="on">
<input name="form-name" type="hidden" value="order"/>
<input id="cart_summary" name="cart_summary" type="hidden"/>
<label for="fullName">Full Name</label>
<input id="fullName" name="fullName" placeholder="Your full name" required="" type="text"/>
<label for="email">Email Address</label>
<input id="email" name="email" placeholder="you@example.com" required="" type="email"/>
<label for="phone">Phone Number</label>
<input id="phone" name="phone" placeholder="+254 7XX XXX XXX" required="" type="tel"/>
<label for="address">Delivery Address</label>
<textarea id="address" name="address" placeholder="Enter delivery location" required="" rows="3"></textarea>
<div class="checkout-actions">
<a class="loan-btn secondary" href="shop.html">‚Üê Back to Shop</a>
<button class="btn" type="submit">Place Order ‚Üí</button>
</div>
</form>
</div>
<footer>
  ¬© 2025 WattSun Solar Kenya | <div class="footer-contacts"><a href="mailto:info@wattsun.co.ke">info@wattsun.co.ke</a></div>
</footer>
<script>
function toggleNav() {
  var nav = document.getElementById("mainNav");
  nav.classList.toggle("active");
}
window.addEventListener('resize', function() {
    if(window.innerWidth > 800) {
        document.getElementById("mainNav").classList.remove("active");
    }
});

document.addEventListener("DOMContentLoaded", function () {
  // If we've just come from calculator.html, stash the selected kit
  const selectedKit = JSON.parse(localStorage.getItem("wattSunSelectedKit"));
  if (selectedKit) {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    if (!cart.some(item => item.name === selectedKit.kit)) {
      cart.push({
        name: selectedKit.kit,
        price: selectedKit.price,
        deposit: Math.round(selectedKit.price * 0.5),
        quantity: 1,
        description: selectedKit.description || ""
      });
      localStorage.setItem("cart", JSON.stringify(cart));
    }
    localStorage.removeItem("wattSunSelectedKit");
  }

  function formatNumber(num) {
    return Number(num).toLocaleString('en-US');
  }

  // Helper to truncate description for table column
  function truncateDesc(desc) {
    return desc && desc.length > 60 ? desc.substring(0, 57) + '...' : desc;
  }

  function renderCart() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const tbody = document.querySelector("#cartTable tbody");
    const summary = document.getElementById("cart_summary");
    tbody.innerHTML = "";
    let totalDeposit = 0;
    let cartSummaryArr = [];

    cart.forEach(item => {
      const qty = item.quantity || 1;
      const desc = item.description || "";
      const deposit = item.deposit;
      const totalPrice = item.price * qty;
      const totalItemDeposit = deposit * qty;
      totalDeposit += totalItemDeposit;

      cartSummaryArr.push(
        `${item.name} (x${qty}): Price ${item.price}, Deposit ${deposit}`
      );

      const row = document.createElement('tr');
      row.innerHTML = `
        <td class="product-col">${item.name}</td>
        <td class="checkout-desc-tooltip" data-desc="${desc.replace(/"/g, '&quot;')}">${truncateDesc(desc)}</td>
        <td class="col-unit">${formatNumber(item.price)}</td>
        <td>${formatNumber(deposit)}</td>
        <td class="col-qty">${qty}</td>
        <td class="col-total">${formatNumber(totalPrice)}</td>
        <td class="col-total-deposit">${formatNumber(totalItemDeposit)}</td>
      `;
      tbody.appendChild(row);
    });

    document.getElementById("totalAmount").textContent =
      "Total Deposit: KES " + totalDeposit.toLocaleString();
    summary.value = cartSummaryArr.join("\n");
  }

  renderCart();

  document.getElementById("checkoutForm").addEventListener("submit", function(e) {
      let valid = true;
      this.querySelectorAll('input[required], textarea[required]').forEach(input => {
          if (!input.value.trim() || input.value.trim() === "0") {
              input.style.borderColor = "red";
              valid = false;
          } else {
              input.style.borderColor = "";
          }
      });
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      if (cart.length === 0) {
          alert("Your cart is empty.");
          valid = false;
      }
      if (!valid) {
          e.preventDefault();
          return false;
      }
      sessionStorage.setItem("clearCartOnThankYou", "true");
  });
});

if (window.location.pathname.endsWith("thankyou.html") && sessionStorage.getItem("clearCartOnThankYou")) {
    localStorage.removeItem("cart");
    sessionStorage.removeItem("clearCartOnThankYou");
}
</script>
</body>
</html>
